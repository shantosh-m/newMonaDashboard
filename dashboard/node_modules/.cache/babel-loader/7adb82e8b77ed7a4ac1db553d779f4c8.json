{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ASUS\\\\Desktop\\\\Dashboard\\\\newMonaDashboard\\\\dashboard\\\\src\\\\contexts\\\\machinecontext.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\n// MachineContext.js\nimport { createContext, useContext, useState } from \"react\";\nimport { useEffect } from \"react\";\nimport axios from \"axios\";\nimport socketIOClient from \"socket.io-client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MachineContext = /*#__PURE__*/createContext();\n\nconst {\n  io\n} = require(\"socket.io-client\");\n\nexport const MachineProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [machineData, setMachineData] = useState();\n\n  const fetchDataFromBackend = async () => {\n    try {\n      const response = await axios.get(\"http://localhost:3002/gettingMachineInfo\");\n      setMachineData(response.data);\n      console.log(\"Backend API Response:\", response.data);\n    } catch (error) {\n      console.error(\"Error fetching machine data:\", error);\n    }\n  }; //   useEffect(() => {\n  //     return () => {\n  //         socket.disconnect();\n  //     };\n  // }, []);\n\n\n  const setupSocketListener = () => {\n    const socket = io(\"http://localhost:3001\");\n    socket.on(\"updated_protector_messages\", updatedMessages => {\n      if (updatedMessages.type == \"run\") setMachineData(state => {\n        return state.map(machine => {\n          if (machine.moldProtector == updatedMessages.protector_id) {\n            console.log(\"success or fail\", updatedMessages.data.success);\n            if (updatedMessages.data.success == 1) return { ...machine,\n              moldShots: machine.moldShots + 1\n            };else updatedMessages.data.success == 0;\n            return { ...machine,\n              failedShots: machine.failedShots + 1\n            };\n          } else return machine;\n        });\n      });else if (updatedMessages.type == \"status\") setMachineData(state => {\n        return state.map(machine => {\n          if (machine.moldProtector == updatedMessages.protector_id) {\n            if (updatedMessages.data.status == \"working\" || updatedMessages.data.status == \"stuck\" || updatedMessages.data.status == \"error\" || updatedMessages.data.status == \"notWorking\") return { ...machine,\n              status: updatedMessages.data.status\n            };else return machine;\n          } else return machine;\n        });\n      });\n      console.log(updatedMessages, \"up-msg\");\n      console.log(updatedMessages.data, \"status\"); // setProtectorMessages(updatedMessages);\n      // Object.entries(updatedMessages).forEach(([protectorId, messages]) => {\n      //     messages.forEach(message => {\n      //         console.log(`Message received from Protector ${protectorId}: total_shots: ${message.total_shots}, failed_shots: ${message.failed_shots}`);\n      //     });\n      // });\n    });\n  };\n\n  useEffect(() => {\n    fetchDataFromBackend(); // Fetch initial data when the component mounts\n\n    setupSocketListener();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(MachineContext.Provider, {\n    value: {\n      machineData\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 84,\n    columnNumber: 5\n  }, this);\n};\n\n_s(MachineProvider, \"9ukQ3/1AJ2Gl+iZphDP9yxtVErA=\");\n\n_c = MachineProvider;\nexport const useMachineContext = () => {\n  _s2();\n\n  return useContext(MachineContext);\n};\n\n_s2(useMachineContext, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"MachineProvider\");","map":{"version":3,"names":["createContext","useContext","useState","useEffect","axios","socketIOClient","MachineContext","io","require","MachineProvider","children","machineData","setMachineData","fetchDataFromBackend","response","get","data","console","log","error","setupSocketListener","socket","on","updatedMessages","type","state","map","machine","moldProtector","protector_id","success","moldShots","failedShots","status","useMachineContext"],"sources":["C:/Users/ASUS/Desktop/Dashboard/newMonaDashboard/dashboard/src/contexts/machinecontext.js"],"sourcesContent":["// MachineContext.js\r\nimport { createContext, useContext, useState } from \"react\";\r\nimport { useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport socketIOClient from \"socket.io-client\";\r\n\r\nconst MachineContext = createContext();\r\n\r\nconst { io } = require(\"socket.io-client\");\r\n\r\nexport const MachineProvider = ({ children }) => {\r\n  const [machineData, setMachineData] = useState();\r\n\r\n  const fetchDataFromBackend = async () => {\r\n    try {\r\n      const response = await axios.get(\r\n        \"http://localhost:3002/gettingMachineInfo\"\r\n      );\r\n      setMachineData(response.data);\r\n      console.log(\"Backend API Response:\", response.data);\r\n    } catch (error) {\r\n      console.error(\"Error fetching machine data:\", error);\r\n    }\r\n  };\r\n\r\n  //   useEffect(() => {\r\n\r\n  //     return () => {\r\n  //         socket.disconnect();\r\n  //     };\r\n  // }, []);\r\n\r\n  const setupSocketListener = () => {\r\n    const socket = io(\"http://localhost:3001\");\r\n\r\n    socket.on(\"updated_protector_messages\", (updatedMessages) => {\r\n      if (updatedMessages.type == \"run\")\r\n        setMachineData((state) => {\r\n          return state.map((machine) => {\r\n            if (machine.moldProtector == updatedMessages.protector_id) {\r\n              console.log(\"success or fail\", updatedMessages.data.success);\r\n              if (updatedMessages.data.success == 1)\r\n                return { ...machine, moldShots: machine.moldShots + 1 };\r\n              else updatedMessages.data.success == 0;\r\n              return { ...machine, failedShots: machine.failedShots + 1 };\r\n            } else return machine;\r\n          });\r\n        });\r\n      else if (updatedMessages.type == \"status\")\r\n        setMachineData((state) => {\r\n          return state.map((machine) => {\r\n            if (machine.moldProtector == updatedMessages.protector_id) {\r\n              if (\r\n                updatedMessages.data.status == \"working\" ||\r\n                updatedMessages.data.status == \"stuck\" ||\r\n                updatedMessages.data.status == \"error\" ||\r\n                updatedMessages.data.status == \"notWorking\"\r\n              )\r\n                return { ...machine, status: updatedMessages.data.status };\r\n              else return machine;\r\n            } else return machine;\r\n          });\r\n        });\r\n\r\n      console.log(updatedMessages, \"up-msg\");\r\n      console.log(updatedMessages.data, \"status\");\r\n\r\n      // setProtectorMessages(updatedMessages);\r\n      // Object.entries(updatedMessages).forEach(([protectorId, messages]) => {\r\n      //     messages.forEach(message => {\r\n      //         console.log(`Message received from Protector ${protectorId}: total_shots: ${message.total_shots}, failed_shots: ${message.failed_shots}`);\r\n      //     });\r\n\r\n      // });\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchDataFromBackend(); // Fetch initial data when the component mounts\r\n    setupSocketListener();\r\n  }, []);\r\n\r\n  return (\r\n    <MachineContext.Provider value={{ machineData }}>\r\n      {children}\r\n    </MachineContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useMachineContext = () => {\r\n  return useContext(MachineContext);\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}